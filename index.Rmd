---
title: "ETC5521 Assignment 2"
subtitle: "Australian Animal Outcomes"
team: galah
author:
  - Sen Wang
  - Muhammad Soban Qasim
  - Lachlan Moody
  - Xitong He
date: "`r Sys.Date()`"
bibliography: references.bib
biblio-style: authoryear-comp
output: 
  bookdown::html_document2
---

[This assignment is for ETC5521 Assignment 2 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}


# Introduction and motivation

Animals are all around us in the sky, in the oceans, in our backyards, and our homes. What happens to these animals in trouble, it could be cats, dogs, horses, or livestock? Who takes care of them when they are in trouble or are lost? The answer is the Royal Society for the Prevention of Cruelty to Animals. You can find more about RSPCA or the Royal Society for the Prevention of Cruelty to Animals [here](https://www.rspca.org.au/). @About_Us.  

The RSPCA is Australiaâ€™s oldest, largest and most trusted animal welfare organization, according to its description, there is a gradual increase in the number of animals every year which are received in animal shelters and adoption centers across the country. RSPCA decides to analyze the results of animals in Australia and help them.

While looking online and researching RSPCA we came across many articles that were indirectly blaming RSPCA for their high euthanize rates and some individuals who saw the worst side of RSPCA. That got us interested in the outcomes from RSPCA and as RSPCA operates state wise. After a while, it raised a question about which animal is euthanized most. One of the recent events that motivated us looking into the euthanization rates, you can read about it by clicking [here](https://mobile.abc.net.au/news/2020-02-26/rscpa-qld-issues-apology-after-accidentally-euthanasing-kitten/12001668).  @powell_2020

We also came across multiple articles and web pages dedicated to the adoption of animals that have been in the care of RSPCA. We wanted to know which state rehomes the most animals. If you are interested please click this [link](https://www.rspca.org.au/adopt-pet). @Adopt_A_Pet

Finally, cat person or dog person a comparison between the two types of people out there, which lost pet is most likely to get reclaimed.



 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = FALSE, warning = FALSE)
```

```{r libraries}
library(tidytuesdayR)
library(tidyr)
library(ggplot2)
library(dplyr)
library(rgdal)
library(maptools)
library(plyr)
library(rgeos)
library(plotly)
library(mapproj)
library(leaflet)
library(tmaptools)
library(sf)
library(broom)
library(kableExtra)
library(treemapify)
```

```{r load-data, echo=FALSE, message=FALSE, cache=TRUE, include=FALSE}

tuesdata <- tidytuesdayR::tt_load(2020, week = 30) #downloading the data set as instructed in the git repo
```

```{r data, cache=TRUE}
animal_outcomes <- tuesdata$animal_outcomes  #seperating the data files for easier navigation
animal_complaints <- tuesdata$animal_complaints
brisbane_complaints <- tuesdata$brisbane_complaints
```

# Data description

In this section, we will mainly introduce the data structure, data sources and data description.

There are three data sets used on this analysis, and the cleaned data is obtained from [GitHub tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-07-21/readme.md).  

The `animal_outcome` data source is from [source website](https://www.rspca.org.au/what-we-do/our-role-caring-animals/annual-statistics), which is the annual data from 1999 to 2018, consisting of `r nrow(animal_outcomes)` observation. It contains eight main states in Australia and the data structure and detail is shown as the below tables. 

```{r outcome-data}
outcome_data <- data.frame(
  Variable = c("year", "animal_type", "outcome", "ACT", 
               "NSW", "NT", "QLD", "SA","TAS","VIC","WA","Total"),
  Class=c("double","character","character","double","double","double","double","double","double","double","double","double"),
  Description = c("Full year","Animal type (horse, wildlife, dog, cat, etc)",
                  "Animal outcome - euthanized, released, rehomed, etc",
                  "ACT - Australian Capital Territory",
                  "New South Wales",
                  "Northern Territory",
                  "Queensland",
                  "South Australia",
                  "Tasmania",
                  "Victoria",
                  "Western Australian",
                  "Australian Total"))

outcome_data %>%
  kable(caption = "Animal outcomes data") %>%
  kable_styling(bootstrap_options = 
                c("striped", "condensed"), 
                full_width = F, 
                position = "center")
```

The `animal_complaints` data is from Australia government data [source sebsite](https://data.gov.au/data/dataset/animal-complaints), and the cleaned data is obtained from [Github tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-21/animal_complaints.csv) which is from April 2014 to May 2020. It also contain `r nrow(animal_complaints)` observation with different type of animals and complaints. The variable information included in the data is displayed in the following table.

```{r complaints-data}
complaints_data <- tibble(Variable = c("Animal Type", "Complaint Type", "Date Received", "Suburb", "Electoral Division"),
                          Class = c( "character", "character","character", "character","character"),
                          Description = c("Animal Type", 
                                          "Complaint type", 
                                          "Date received (Month - year)", 
                                          "Suburb/region", 
                                          "Electoral Division")) 
complaints_data %>%
  kable(caption = "Animal complaints data") %>%
  kable_styling(bootstrap_options = "striped", 
                position = "center")
```

The `brisbane_complaints` data focus on the Brisbane city and it comes form Brisbane city council[source website](https://www.data.brisbane.qld.gov.au/data/dataset/96bec69c-6170-4ef0-93f1-eda279149b97), and the cleaned data is from [Github tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-21/brisbane_complaints.csv). `r nrow(brisbane_complaints)` observation are recorded from February 2016 to December 2019 to in this dataset, and the animal type and complaint type are mainly used in this analysis. The following table is shown more details in this dataset:

```{r brisbane-data}
complaints_data <- tibble(Variable = c("nature", "animal_type", "category", "suburb", "date_range","responsible_office","city"),
                          Class = c( "character", "character","character", "character","character","character", "character"),
                          Description = c("Nature of complaints (animal)", 
                                          "Animal type", 
                                          "Category of complaint", 
                                          "Suburb where reported", 
                                          "Date range (typically 1 quarter + year)",
                                          "Responsible office for the complaint",
                                          "City (Brisbane)")) 
complaints_data %>%
  kable(caption = "Animal complaints data") %>%
  kable_styling(bootstrap_options = "striped", 
                position = "center")
```

## Limitations

The `animal_outcomes` data set has not specified that suburbs, which limit our approach to identifying which suburb has the most common complaint type. This can also help to identify which suburb has the most animal type too by looking into the animal type the complaint was made against. Moreover, the number for the animals outcome might be effected by the different legislation governing the animal welfare.

For the `animal_complaints` data ,the *Suburb* variable is only recorded the suburb from Queensland which makes analyze complaint issue more specific and not in the general perspective. Another limitation in this dataset is about animal type which are only contained two animals such as cat and dogs so it is limited to analyze people complaints problems and raise the deviation in results.
  
In the `brisbane_complaints` data set, the *date* variable range is difficult to apprehend, because of fluctuating ranges and inconsistencies. In addition, it is hard to re-defined the date variable as it mixed different types of date range such as quarterly and monthly data. Furthermore, Brisbane is the capital of Queensland, indicating that this dataset is still under Queensland State but the *suburb* variable become to be specified in the Brisbane city.


# Questions


## Q1: Which state has highest rate for the best possible outcome for animals?

-> Animals are taken into care by RSPCA animals that are neglected, animals that are reported, and animals that require care. sometimes RSPCA has to make a tough decision of euthanizing the animal, which is the most humane alternative, the reason could be medical, behavioural problems, etc. 

There are other outcomes too, rehomed, in care, in stock, reclaimed, etc. Anything other than euthanization is a good outcome. Let us look at the animals saved by RSPCA or the rescue rate. 

```{r loading rds map}

aus_map <- readRDS("oz_map.rds") #loading the rds map file 

```

```{r calculating good outcomes}

q1 <- animal_outcomes %>% select(-year, 
                   -animal_type) %>% 
  group_by(outcome) %>% 
  summarise_at(vars(ACT, 
                    NSW, 
                    NT, 
                    QLD, 
                    SA, 
                    TAS, 
                    VIC, 
                    WA),  
               list( sum),na.rm=TRUE) #suming up the outcomes category wise




q11 <-  pivot_longer(q1, `ACT`:`WA`, 
                     names_to = "State", 
                     values_to = "outcomes") %>% 
  pivot_wider(names_from = outcome, 
              values_from = outcomes) #wranggling to get better visualizing sense

q11 <- q11 %>%  mutate(good_outcome = (rowSums(q11[,c(-1,-3)]))/rowSums(q11[,c(-1)])*100) #calculating percentage of good outcomes by taking out euthanization and dividing it by the total number of outcomes per state 

                                                                                                    q12 <- q11 %>% select(State, 
                                                                                                                         good_outcome)           #selecting variables for ease 
                                                                                                    
                                                                                                    
```


```{r getting the states up}
aus_map_states <- aus_map %>% 
  left_join(q12, by = c("state_abb" = "State"))  #joining data sets by states
 

```



```{r survivalrate, fig.height=8, fig.width=10,fig.cap="Australia Rescue rate", message=FALSE, warning=FALSE, include=FALSE}
state_plot <- ggplot(aus_map_states, 
                     aes(x = longitude, 
                         y = latitude, 
                         fill = good_outcome)) + #plotting the data on the map
  geom_sf() + aes(x = longitude, 
                  y = latitude) +   
  labs(subtitle="Animals saved by RSPCA", 
       y=" ", 
       x=" ", 
       caption = "Australia Rescue rate")+ #getting the captions and titles
  geom_sf_text(aes(label = state), 
               colour = "white")
  scale_fill_viridis_c( "alpha = 1",
  "begin = 0",
  "end = 100",
  "direction = 1",
  option = "D",
  values = NULL,  
  space = "Lab",
  na.value = "black",
  guide = "colourbar",
  aesthetics = "fill"
) 
  

```


```{r Animalsurvivalrate, fig.height=12, fig.width=12,fig.cap="Australia Rescue rate"}
state_plot 
```


Figure  \@ref(fig:Animalsurvivalrate), shows the rate of animals that are in the care of RSPCA, find a good outcome, from the year 1999 to 2018, where animals can be either reclaimed, rehomed, released, in stock, transferred, or be currently in care. The plot clearly shows Western Australia to have the highest good outcome rate of over 75%, while sadly New South Wales has the lowest good outcome rate of 55%. Otherwise meaning that the rest of the 45% of animals are euthanized.  







## Q2: Which animal is euthanized the most throughout Australia?

-> There are lot of animals that pass through RSPCA let us look at which animal is euthanized the most by RSPCA in Australia.

```{r getting counts, include=FALSE}
animal_outcomes  %>% group_by( year,
                 outcome, 
                 animal_type) %>%                         
  summarise_at(vars(ACT, 
                    NSW, 
                    NT, 
                    QLD, 
                    SA, 
                    TAS, 
                    VIC),  
               list( sum)) 

q2 <- animal_outcomes %>% filter(outcome == "Euthanized") %>% 
  select(animal_type, 
         ACT, 
         NSW, 
         NT, 
         QLD, 
         SA, 
         TAS, 
         VIC, 
         WA) %>%  
  group_by(animal_type) %>%                         
  summarise_at(vars(ACT,          #getting sums with respect to state
                    NSW, 
                    NT, 
                    QLD, 
                    SA, 
                    TAS, 
                    VIC, 
                    WA),            
               list(" " = sum)) 

 q2$total_animals_euthanised = rowSums(q2[,c(-1)], na.rm=TRUE) #getting the sum of total animals euthanized
```


```{r AustraliaEuthanizationcount, fig.width=8, fig.height=8, fig.cap="Animal Euthanization count"}
options(scipen=999)
 p2 <- ggplot(q2,
              aes(x =reorder(animal_type, 
                             -total_animals_euthanised), #arranging the plot
                  y =  total_animals_euthanised)) + 
   geom_bar(stat="identity", 
            fill="tomato3") +                          #adding color
   labs(subtitle="Which animal is the most euthanized", 
       y="Count", 
       x="Animals", 
       title="Australia Euthanization count",                   #giving title
       caption = "Australia Euthanization rate") + 
  theme(axis.text.x = element_text(angle=45, vjust=0.9)) + 
   ylim(c(0, 600000)) 

ggplotly(p2)
```

Figure  \@ref(fig:AustraliaEuthanizationcount), shows us the euthanization count by animal type throughout Australia from the year 1999 to 2018. Cats have the highest recorded euthanization count at 553,956 in Australia under the care of RSPCA. 


## Q3: What is the percentage of rehomed animals state wise?

-> In which state do animals have better odds of being rehomed. 

```{r Rehomed}
animal_outcomes2 <- animal_outcomes %>%
  filter(outcome == "Rehomed")


ACT_Rehomed_Ttl <- sum(animal_outcomes2$ACT)     #getting sum of total rehomed animal by state
NSW_Rehomed_Ttl <- sum(animal_outcomes2$NSW)
NT_Rehomed_Ttl <- sum(animal_outcomes2$NT, na.rm = TRUE)
QLD_Rehomed_Ttl <- sum(animal_outcomes2$QLD)
SA_Rehomed_Ttl <- sum(animal_outcomes2$SA)
TAS_Rehomed_Ttl <- sum(animal_outcomes2$TAS)
VIC_Rehomed_Ttl <- sum(animal_outcomes2$VIC)
WA_Rehomed_Ttl <- sum(animal_outcomes2$WA)
```

```{r Total}
ACT_Ttl <- sum(animal_outcomes$ACT)
NSW_Ttl <- sum(animal_outcomes$NSW)
NT_Ttl <- sum(animal_outcomes$NT, na.rm = TRUE)
QLD_Ttl <- sum(animal_outcomes$QLD)
SA_Ttl <- sum(animal_outcomes$SA, na.rm = TRUE)
TAS_Ttl <- sum(animal_outcomes$TAS, na.rm = TRUE)
VIC_Ttl <- sum(animal_outcomes$VIC)
WA_Ttl <- sum(animal_outcomes$WA)
```

```{r New_dataset}
d <- data.frame(
  State = c("ACT",    #making a data frame
            "NSW", 
            "NT", 
            "QLD", 
            "SA", 
            "TAS", 
            "VIC", 
            "WA"),
  Rehomed_Ttl = c(ACT_Rehomed_Ttl, 
                  NSW_Rehomed_Ttl, 
                  NT_Rehomed_Ttl, 
                  QLD_Rehomed_Ttl, 
                  SA_Rehomed_Ttl, 
                  TAS_Rehomed_Ttl, 
                  VIC_Rehomed_Ttl, 
                  WA_Rehomed_Ttl),
  Total = c(ACT_Ttl, 
            NSW_Ttl, 
            NT_Ttl, 
            QLD_Ttl, 
            SA_Ttl, 
            TAS_Ttl, 
            VIC_Ttl, 
            WA_Ttl)
)  %>%
  mutate(Percent = round(Rehomed_Ttl/Total*100)) #calculating percenatge of rehomed animals
```


```{r plot3, fig.width = 8, fig.height = 6, fig.cap="The percentage of rehomed animals state wise", fig.align= "center"}
p3 <- ggplot(d, 
             aes(x=reorder(State,Percent),  #plotting the data
                 y=Percent)) +
  geom_histogram(stat="identity", 
                 fill = "lightblue", 
                 position = "dodge",
                 width= 0.8) +
  xlab("State") +
  ylab("Percentage") +
  ggtitle("The percentage of rehomed animals state wise")

ggplotly(p3)
```

In Figure  \@ref(fig:plot3), it is clear that the highest proportion of animals were relocated in WA and the lowest proportion in QLD, but the difference between them is so much as only 13 percent. This also corroborates with Figure  \@ref(fig:Animalsurvivalrate) in terms of good outcome. 

## Q4: Is there a relationship between the type of animal and its outcome?




## Q5: Cats versus dogs who are more likely to get reclaimed?
 

-> A very interesting question are there more cat people or dog people. 


```{r screening}
animal_outcomes3 <- animal_outcomes %>%
  filter(outcome == "Reclaimed") %>%
  filter(animal_type == c("Dogs", "Cats")) #filtering required animal types
```

```{r plot4, fig.width = 8, fig.height = 6, fig.cap="Reclaimed animals: Timeline", fig.align= "center"}
p4 <-  ggplot(animal_outcomes3, 
              aes( x = year,
              y = Total, 
              group = as.factor(animal_type),
              shape = as.factor(animal_type),
              colour = as.factor(animal_type))) +
  geom_line() +
  geom_point() +
  ggtitle("Reclaimed animals: Timeline") +
  theme(legend.title=element_blank())

ggplotly(p4)
```

In Figure  \@ref(fig:plot4), from 1999 to 2018 the number of reclaimed cats has been stable, while the number of reclaimed dogs has fluctuated over the years. 2009 was a good year for dogs.

### While we are at the subject of cats versus dogs, who gets the most complaints? 

```{r complaints}
x1 <- animal_complaints %>% 
  select(`Animal Type`) %>%  #selecting animal type to get total count oer animal type 
  count() 

```


```{r ComplaintsagainstwhoCatsorDogs, fig.cap="Complaints against who: Cats or Dogs"}
p4e <- x1 %>% ggplot(aes(x = Animal.Type, 
                 y = freq)) + 
  geom_bar(stat="identity", 
           fill="yellow") + 
  ylab("number of complaints") + xlab(" ") +  ggtitle("Complaints Launched")

ggplotly(p4e)
```


Figure  \@ref(fig:ComplaintsagainstwhoCatsorDogs),  shows that dog complaints made by people are disproportionately higher than complaints against cats.

### What are the most frequent complaints in Brisbane?

```{r brisbanecomplaints}
brisbane_complaints_category <- brisbane_complaints  %>% select(category) #selecting category

brisbane_complaints_category <- brisbane_complaints_category %>% 
  group_by(category) %>% 
  tally()                   #getting tally of the compalints made in brisbane

brisbane_complaints_category <- na.omit(brisbane_complaints_category)
```

```{r treemap, fig.cap="Complaints made in Brisbane"}

 p9 <- ggplot(brisbane_complaints_category, 
              ggplot2::aes(area = n,
                           label = category, 
                           fill = category)) + 
 geom_treemap() + 
  geom_treemap_text( stat = "identity", 
                     position = "identity", 
  na.rm = FALSE, 
  show.legend = FALSE, 
  inherit.aes = TRUE, 
  padding.x = grid::unit(1, "mm"), 
  padding.y = grid::unit(1, "mm"), 
  place = "topleft", 
  min.size = 4, 
  grow = FALSE, 
  reflow = FALSE, 
  fixed = NULL, 
  layout = "squarified", 
  start = "bottomleft") 
p9 +  ggtitle("Complaints made in Brisbane")
```

Figure  \@ref(fig:treemap), shows us that in Brisbane the highest complaint rate is Fencing issues, followed by wandering animals, attack on animals, and attack on a person. 

## Q6: How the different type of complaints are distributed in dogs and cats?



# Conclusion

In conclusion, RSPCA does what is best for the animals, there may be other factors involved such as state laws, size of the state, wildlife concentration, population in the state, that needs to be taken under consideration when looking at things such as good outcome rates, euthanization counts, rehomed animals, etc. 


The R packages we used in this report: 
@tidytuesdayR
@tidyr,  
@ggplot2, 
@dplyr,
@rgdal,
@maptools,
@plyr,
@rgeos,
@plotly, 
@mapproj, 
@leaflet, 
@tmaptools, 
@sf,
@broom,
@kableExtra,
@treemapify


# References
